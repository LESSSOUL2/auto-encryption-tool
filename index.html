<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Auto Encryption / Decryption Tool</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<style>
body{
  background:#020403;color:#eafff4;
  font-family:monospace;padding:20px
}
.container{max-width:700px;margin:auto}
textarea,button{
  width:100%;margin-top:10px;
  padding:10px;border-radius:8px;
  background:#000;color:#00ff88;
  border:1px solid #00ff88
}
button{cursor:pointer;font-weight:bold}
.note{font-size:12px;color:#7fa99a;margin-top:6px}
</style>
</head>

<body>
<div class="container">
<h2>Auto Encryption / Decryption (Devglan-style)</h2>

<textarea id="input" placeholder="Enter text or encrypted data"></textarea>

<button onclick="encrypt()">Encrypt</button>
<button onclick="decrypt()">Decrypt</button>
<button onclick="resetKey()">Reset Auto Key</button>

<textarea id="output" placeholder="Output" readonly></textarea>

<div class="note">
Auto mode uses a browser-generated AES key stored locally.<br>
Clearing browser data or clicking “Reset Auto Key” will break decryption.
</div>
</div>

<script>
/* ===== AUTO KEY (HIDDEN) ===== */
function getAutoKey(){
  let keyHex = localStorage.getItem("auto_aes_key");
  if(!keyHex){
    keyHex = CryptoJS.lib.WordArray.random(16).toString(CryptoJS.enc.Hex);
    localStorage.setItem("auto_aes_key", keyHex);
  }
  return CryptoJS.enc.Hex.parse(keyHex);
}

/* ===== ENCRYPT ===== */
function encrypt(){
  const text = document.getElementById("input").value;
  if(!text) return;

  const key = getAutoKey();
  const iv = CryptoJS.lib.WordArray.random(16);

  const encrypted = CryptoJS.AES.encrypt(
    text,
    key,
    { iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
  );

  document.getElementById("output").value =
    iv.toString(CryptoJS.enc.Hex) + ":" + encrypted.toString();
}

/* ===== DECRYPT ===== */
function decrypt(){
  const data = document.getElementById("input").value;
  if(!data || !data.includes(":")){
    document.getElementById("output").value = "[!] Invalid encrypted input";
    return;
  }

  const key = getAutoKey();
  const [ivHex, cipher] = data.split(":");

  try{
    const iv = CryptoJS.enc.Hex.parse(ivHex);
    const decrypted = CryptoJS.AES.decrypt(
      cipher,
      key,
      { iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
    ).toString(CryptoJS.enc.Utf8);

    document.getElementById("output").value =
      decrypted || "[!] Decryption failed";
  }catch{
    document.getElementById("output").value = "[!] Decryption error";
  }
}

/* ===== RESET KEY ===== */
function resetKey(){
  localStorage.removeItem("auto_aes_key");
  alert("Auto encryption key reset.\nOld ciphertexts can no longer be decrypted.");
}
</script>
</body>
</html>
